---
import Layout from '@/layouts/Layout.astro';
import { portfolioService } from '@/service/portfolio';
import type { Project } from '@/types/portfolio';
import type { ProjectCategory } from '@/types/portfolio';

const projectsResponse = await portfolioService.getProjects();
const projects: Project[] = projectsResponse.results;
const categoriesResponse = await portfolioService.getCategories();
const categories: ProjectCategory[] = categoriesResponse;
---

<Layout title="Portfolio">
  <section class="py-8">
    <h1 class="text-4xl font-bold mb-8">Portfolio</h1>
    
    {categories.length > 0 && (
      <div class="mb-8">
        <div class="flex flex-wrap gap-2">
          <a 
            href="/portfolio" 
            class="px-4 py-2 rounded-full bg-primary-600 text-white"
          >
            All
          </a>
          {categories.map((category) => (
            <a 
              href={`/portfolio?category=${category.slug}`}
              class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition"
            >
              {category.name}
            </a>
          ))}
        </div>
      </div>
    )}

    {projects.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {projects.map((project) => (
          <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition">
            {project.thumbnail && (
              <img 
                src={project.thumbnail} 
                alt={project.title}
                class="w-full h-48 object-cover"
              />
            )}
            <div class="p-6">
              <div class="flex flex-wrap gap-2 mb-3">
                {project.technologies.slice(0, 3).map((tech) => (
                  <span class="text-xs px-2 py-1 bg-primary-100 text-primary-700 rounded">
                    {tech.name}
                  </span>
                ))}
              </div>
              <h2 class="text-xl font-semibold mb-2">{project.title}</h2>
              <p class="text-gray-600 mb-4">{project.short_description}</p>
              <div class="flex space-x-4">
                <a 
                  href={`/portfolio/${project.slug}`} 
                  class="text-primary-600 hover:text-primary-700 font-medium"
                >
                  View Details â†’
                </a>
                {project.live_url && (
                  <a 
                    href={project.live_url} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="text-gray-600 hover:text-gray-800 font-medium"
                  >
                    Live Demo
                  </a>
                )}
              </div>
            </div>
          </article>
        ))}
      </div>
    ) : (
      <p class="text-gray-600 text-center py-12">No projects found.</p>
    )}
  </section>
</Layout>
